<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Dashboard</title>
</head>

<body>
    <h1>Search for a City:</h1>

    <!-- this form is used to get the user input -->
    <form id="city-form">
        <label for="city-input">Search for a city</label>
        <input type="text" id="city-input"><br>

        <!-- this button will trigger our AJAX call -->
        <input id="find-city" type="submit" value="City Search">
    </form>

    <!-- Weather data placeholders -->
    <h1 class="city-date"></h1>
    <div class="temperature"></div>
    <div class="humidity"></div>
    <div class="wind-speed"></div>
    <div class="uv-index"></div>

    <!-- jQuery library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <!-- https://momentjs.com/ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>

    <script type="text/javascript">
        $("#find-city").on("click", function (event) {
            // Preventing the submit button from trying to submit the form
            // We're optionally using a form so the user may hit Enter to search instead of clicking the button
            event.preventDefault();

            // OpenWeatherApp API key 
            let userInputCity = $("#city-input").val();
            let APIKey = "870109d2706d7781ec3e7e2c0c95b193";

            // Build the URL for the ajax call
            let queryURL = "https://api.openweathermap.org/data/2.5/weather?q=" + userInputCity + "&appid=" +
                APIKey;

            // AJAX call
            $.ajax({
                url: queryURL,
                method: "GET"
            }).then(function (response) {
                // check the response
                console.log(response);

                // Kelvin to Fahrenheit: F = (K - 273.15) * 1.80 + 32
                let tempF = ((response.main.temp - 273.15) * 1.80 + 32).toFixed(1);
                // get lat and lon coordinates for the uv index 
                let lat = response.coord.lat;
                let lon = response.coord.lon;
                console.log(lat + " lats");
                console.log(lon + " long");

                // build the URL for the second ajax call for the UV index using the lat and lon coordinates of the user input city
                let UVIndexQueryURL = "http://api.openweathermap.org/data/2.5/uvi?lat=" + lat +
                    "&lon=" + lon + "&appid=" + APIKey;

                // make another AJAX call for the UV index
                $.ajax({
                    url: UVIndexQueryURL,
                    method: "GET"
                }).then(function (responseUV) {
                    // check the response
                    console.log(responseUV.value);
                    console.log(responseUV);
                    // get UV index from responseUV
                    let uvIndex = responseUV.value;
                    // attach uvIndex to html 
                    $(".uv-index").text("UV Index: " + uvIndex);
                });

                // attach info to html
                $(".city-date").text(response.name + " (" + (moment().format(
                    "MMMM Do YYYY") + ")"));
                $(".temperature").text("Temperature " +
                    tempF + "\u00B0F");
                $(".humidity").text("Humidity: " + response.main.humidity + "%");
                // convert meters/second to miles/hour with 2.237
                $(".wind-speed").text("Wind speed: " + (response.wind.speed) * 2.237 + " MPH");
            });
        });
    </script>
</body>

</html>